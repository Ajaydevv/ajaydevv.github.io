var _=Object.defineProperty,k=Object.defineProperties;var h=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var g=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var w=(r,t,e)=>t in r?_(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,d=(r,t)=>{for(var e in t||(t={}))g.call(t,e)&&w(r,e,t[e]);if(y)for(var e of y(t))q.call(t,e)&&w(r,e,t[e]);return r},f=(r,t)=>k(r,h(t));var c=(r,t,e)=>new Promise((o,i)=>{var n=a=>{try{l(e.next(a))}catch(u){i(u)}},m=a=>{try{l(e.throw(a))}catch(u){i(u)}},l=a=>a.done?o(a.value):Promise.resolve(a.value).then(n,m);l((e=e.apply(r,t)).next())});import{s}from"./index-CBL9kIpg.js";const C={getStories(r){return c(this,null,function*(){let t=s.from("stories").select(`
        *,
        likes:likes(count),
        comments:comments(count)
      `).order("created_at",{ascending:!1});const{data:e,error:o}=yield t;if(o)throw o;let i=[];if(r){const{data:n}=yield s.from("likes").select("story_id").eq("user_id",r);i=n||[]}return e.map(n=>{var m,l;return f(d({},n),{likes_count:((m=n.likes[0])==null?void 0:m.count)||0,comments_count:((l=n.comments[0])==null?void 0:l.count)||0,user_liked:i.some(a=>a.story_id===n.id)})})})},getStory(r,t){return c(this,null,function*(){var n,m;const{data:e,error:o}=yield s.from("stories").select(`
        *,
        likes:likes(count),
        comments:comments(count)
      `).eq("id",r).single();if(o)throw o;if(!e)return null;let i=!1;if(t){const{data:l}=yield s.from("likes").select("id").eq("story_id",r).eq("user_id",t).single();i=!!l}return f(d({},e),{likes_count:((n=e.likes[0])==null?void 0:n.count)||0,comments_count:((m=e.comments[0])==null?void 0:m.count)||0,user_liked:i})})},createStory(r,t,e){return c(this,null,function*(){try{const o=new Promise((l,a)=>setTimeout(()=>a(new Error("Story creation timeout")),2e4)),i=s.from("stories").insert({title:r.title,content:r.content,author_id:t,author_name:e}).select().single(),{data:n,error:m}=yield Promise.race([i,o]);if(m)throw m;return n}catch(o){throw console.error("Error creating story:",o),o}})},updateStory(r,t){return c(this,null,function*(){const{data:e,error:o}=yield s.from("stories").update(t).eq("id",r).select().single();if(o)throw o;return e})},deleteStory(r){return c(this,null,function*(){const{error:t}=yield s.from("stories").delete().eq("id",r);if(t)throw t})}},P={likeStory(r,t){return c(this,null,function*(){const{error:e}=yield s.from("likes").insert({story_id:r,user_id:t});if(e)throw e})},unlikeStory(r,t){return c(this,null,function*(){const{error:e}=yield s.from("likes").delete().eq("story_id",r).eq("user_id",t);if(e)throw e})},getLikesCount(r){return c(this,null,function*(){const{count:t,error:e}=yield s.from("likes").select("*",{count:"exact",head:!0}).eq("story_id",r);if(e)throw e;return t||0})}},v={getComments(r){return c(this,null,function*(){const{data:t,error:e}=yield s.from("comments").select("*").eq("story_id",r).order("created_at",{ascending:!0});if(e)throw e;return t||[]})},createComment(r,t,e){return c(this,null,function*(){const{data:o,error:i}=yield s.from("comments").insert({story_id:r.story_id,content:r.content,user_id:t,user_name:e}).select().single();if(i)throw i;return o})},updateComment(r,t){return c(this,null,function*(){const{data:e,error:o}=yield s.from("comments").update({content:t}).eq("id",r).select().single();if(o)throw o;return e})},deleteComment(r){return c(this,null,function*(){const{error:t}=yield s.from("comments").delete().eq("id",r);if(t)throw t})}};export{v as c,P as l,C as s};

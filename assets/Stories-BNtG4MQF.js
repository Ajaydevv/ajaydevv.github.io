var A=Object.defineProperty,R=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var E=(c,n,t)=>n in c?A(c,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[n]=t,x=(c,n)=>{for(var t in n||(n={}))$.call(n,t)&&E(c,t,n[t]);if(y)for(var t of y(n))q.call(n,t)&&E(c,t,n[t]);return c},h=(c,n)=>R(c,W(n));var f=(c,n,t)=>new Promise((w,p)=>{var v=m=>{try{j(t.next(m))}catch(N){p(N)}},C=m=>{try{j(t.throw(m))}catch(N){p(N)}},j=m=>m.done?w(m.value):Promise.resolve(m.value).then(v,C);j((t=t.apply(c,n)).next())});import{j as s}from"./ui-CdYL37x2.js";import{r as u}from"./vendor-BcaInPIV.js";import{c as z,u as G,e as d,a as S,L as M,U as J,S as K}from"./index-CKkHQYAn.js";import{C as D,a as F,b as O,c as Q}from"./card-B_G0rC3P.js";import{T as V}from"./textarea-S-6pdMz9.js";import{H as X,M as Z,B as I}from"./badge-BtLAIMwZ.js";import{s as ee,l as L,c as P}from"./database-BCflSPiJ.js";import"./supabase-cZfeQMuK.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=z("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=z("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function xe(){const[c,n]=u.useState([]),[t,w]=u.useState({}),[p,v]=u.useState({}),[C,j]=u.useState(new Set),[m,N]=u.useState(!0),[k,b]=u.useState(new Set),{user:o}=G();u.useEffect(()=>{B()},[o]);const B=()=>f(this,null,function*(){try{const e=yield ee.getStories(o==null?void 0:o.id);n(e)}catch(e){console.error("Error loading stories:",e),d.error("Failed to load stories")}finally{N(!1)}}),H=e=>f(this,null,function*(){try{const l=yield P.getComments(e);w(i=>h(x({},i),{[e]:l}))}catch(l){console.error("Error loading comments:",l),d.error("Failed to load comments")}}),T=(e,l)=>f(this,null,function*(){if(!o){d.error("You must be logged in to like stories");return}try{l?yield L.unlikeStory(e,o.id):yield L.likeStory(e,o.id),n(i=>i.map(a=>a.id===e?h(x({},a),{user_liked:!l,likes_count:l?(a.likes_count||0)-1:(a.likes_count||0)+1}):a))}catch(i){console.error("Error toggling like:",i),d.error("Failed to update like")}}),U=e=>f(this,null,function*(){var i;if(!o){d.error("You must be logged in to comment");return}const l=(i=p[e])==null?void 0:i.trim();if(!l){d.error("Please enter a comment");return}b(a=>new Set(a).add(e));try{const a=yield P.createComment({story_id:e,content:l},o.id,o.name);w(r=>h(x({},r),{[e]:[...r[e]||[],a]})),n(r=>r.map(g=>g.id===e?h(x({},g),{comments_count:(g.comments_count||0)+1}):g)),v(r=>h(x({},r),{[e]:""})),d.success("Comment added successfully!")}catch(a){console.error("Error adding comment:",a),d.error("Failed to add comment")}finally{b(a=>{const r=new Set(a);return r.delete(e),r})}}),Y=e=>f(this,null,function*(){C.has(e)?j(i=>{const a=new Set(i);return a.delete(e),a}):(j(i=>new Set(i).add(e)),t[e]||(yield H(e)))}),_=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return m?s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsx("div",{className:"text-center",children:"Loading stories..."})}):s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsxs("div",{className:"flex justify-between items-center mb-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Stories"}),s.jsx("p",{className:"text-muted-foreground",children:"Discover and share amazing stories"})]}),o&&s.jsx(S,{asChild:!0,children:s.jsxs(M,{to:"/create-story",children:[s.jsx(te,{className:"w-4 h-4 mr-2"}),"Create Story"]})})]}),c.length===0?s.jsx(D,{children:s.jsxs(F,{className:"text-center py-8",children:[s.jsx("p",{className:"text-muted-foreground mb-4",children:"Ajayadev is cooking one. no stories yet!"}),o&&s.jsx(S,{asChild:!0,children:s.jsx(M,{to:"/create-story",children:"Create Your First Story"})})]})}):s.jsx("div",{className:"space-y-6",children:c.map(e=>{var l,i,a;return s.jsxs(D,{children:[s.jsx(O,{children:s.jsx("div",{className:"flex justify-between items-start",children:s.jsxs("div",{className:"space-y-2",children:[s.jsx(Q,{className:"text-xl",children:e.title}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(J,{className:"w-4 h-4"}),e.author_name]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(se,{className:"w-4 h-4"}),_(e.created_at)]})]})]})})}),s.jsxs(F,{children:[s.jsx("p",{className:"text-gray-700 whitespace-pre-wrap mb-4",children:e.content}),s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs(S,{variant:"ghost",size:"sm",onClick:()=>T(e.id,e.user_liked||!1),className:"flex items-center gap-1",disabled:!o,children:[s.jsx(X,{className:`w-4 h-4 ${e.user_liked?"fill-red-500 text-red-500":""}`}),e.likes_count||0]}),s.jsxs(S,{variant:"ghost",size:"sm",onClick:()=>Y(e.id),className:"flex items-center gap-1",children:[s.jsx(Z,{className:"w-4 h-4"}),e.comments_count||0]})]})}),C.has(e.id)&&s.jsxs(s.Fragment,{children:[s.jsx(K,{className:"my-4"}),o&&s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsx(V,{placeholder:"Write a comment...",value:p[e.id]||"",onChange:r=>v(g=>h(x({},g),{[e.id]:r.target.value})),rows:2}),s.jsx(S,{size:"sm",onClick:()=>U(e.id),disabled:k.has(e.id)||!((l=p[e.id])!=null&&l.trim()),children:k.has(e.id)?"Posting...":"Post Comment"})]}),s.jsxs("div",{className:"space-y-3",children:[(i=t[e.id])==null?void 0:i.map(r=>s.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(I,{variant:"secondary",className:"text-xs",children:r.user_name}),s.jsx("span",{className:"text-xs text-muted-foreground",children:_(r.created_at)})]}),s.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:r.content})]},r.id)),((a=t[e.id])==null?void 0:a.length)===0&&s.jsx("p",{className:"text-center text-muted-foreground text-sm py-4",children:"No comments yet. Be the first to comment!"})]})]})]})]},e.id)})})]})}export{xe as StoriesPage};

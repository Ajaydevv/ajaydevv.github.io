var P=Object.defineProperty,F=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var b=(r,a,s)=>a in r?P(r,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[a]=s,y=(r,a)=>{for(var s in a||(a={}))M.call(a,s)&&b(r,s,a[s]);if(w)for(var s of w(a))T.call(a,s)&&b(r,s,a[s]);return r},N=(r,a)=>F(r,I(a));var g=(r,a,s)=>new Promise((d,c)=>{var f=n=>{try{l(s.next(n))}catch(x){c(x)}},u=n=>{try{l(s.throw(n))}catch(x){c(x)}},l=n=>n.done?d(n.value):Promise.resolve(n.value).then(f,u);l((s=s.apply(r,a)).next())});import{j as e}from"./ui-CdYL37x2.js";import{r as m}from"./vendor-BcaInPIV.js";import{c as U,h as z,b as Y,u as $,e as i,a as j,L as R,U as q,S as G}from"./index-kiFB1KWx.js";import{C as v,a as _,b as J,c as K}from"./card-BTbanT-y.js";import{T as O}from"./textarea-Cw1qT2OW.js";import{H as Q,M as V,B as W}from"./badge-B8STFIvR.js";import{s as X,c as L,l as D}from"./database-5uaZxkko.js";import{C as Z}from"./calendar-CWD9fOSG.js";import"./supabase-cZfeQMuK.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=U("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);function de(){const{id:r}=z(),a=Y(),[s,d]=m.useState(null),[c,f]=m.useState([]),[u,l]=m.useState(""),[n,x]=m.useState(!0),[C,k]=m.useState(!1),{user:o}=$();m.useEffect(()=>{r&&(E(),B())},[r,o]);const E=()=>g(this,null,function*(){if(r)try{const t=yield X.getStory(r,o==null?void 0:o.id);d(t)}catch(t){console.error("Error loading story:",t),i.error("Story not found"),a("/stories")}finally{x(!1)}}),B=()=>g(this,null,function*(){if(r)try{const t=yield L.getComments(r);f(t)}catch(t){console.error("Error loading comments:",t),i.error("Failed to load comments")}}),A=()=>g(this,null,function*(){if(!o||!s){i.error("You must be logged in to like stories");return}try{s.user_liked?yield D.unlikeStory(s.id,o.id):yield D.likeStory(s.id,o.id),d(t=>t?N(y({},t),{user_liked:!t.user_liked,likes_count:t.user_liked?(t.likes_count||0)-1:(t.likes_count||0)+1}):null)}catch(t){console.error("Error toggling like:",t),i.error("Failed to update like")}}),H=()=>g(this,null,function*(){if(!o||!s){i.error("You must be logged in to comment");return}const t=u.trim();if(!t){i.error("Please enter a comment");return}k(!0);try{const p=yield L.createComment({story_id:s.id,content:t},o.id,o.name);f(h=>[...h,p]),d(h=>h?N(y({},h),{comments_count:(h.comments_count||0)+1}):null),l(""),i.success("Comment added successfully!")}catch(p){console.error("Error adding comment:",p),i.error("Failed to add comment")}finally{k(!1)}}),S=t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return n?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"text-center",children:"Loading story..."})}):s?e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs(j,{variant:"ghost",onClick:()=>a("/stories"),className:"mb-6",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Back to Stories"]}),e.jsxs(v,{children:[e.jsxs(J,{children:[e.jsx(K,{className:"text-2xl md:text-3xl",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"w-4 h-4"}),s.author_name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"w-4 h-4"}),S(s.created_at)]})]})]}),e.jsxs(_,{children:[e.jsx("div",{className:"prose prose-lg max-w-none dark:prose-invert mb-6",children:e.jsx("p",{className:"text-foreground whitespace-pre-wrap leading-relaxed",children:s.content})}),e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(j,{variant:"ghost",size:"sm",onClick:A,className:"flex items-center gap-2",disabled:!o,children:[e.jsx(Q,{className:`w-5 h-5 ${s.user_liked?"fill-red-500 text-red-500":""}`}),s.likes_count||0," ",(s.likes_count||0)===1?"Like":"Likes"]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(V,{className:"w-5 h-5"}),s.comments_count||0," ",(s.comments_count||0)===1?"Comment":"Comments"]})]}),e.jsx(G,{className:"my-6"}),o&&e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Add a Comment"}),e.jsx(O,{placeholder:"Share your thoughts...",value:u,onChange:t=>l(t.target.value),rows:3}),e.jsx(j,{onClick:H,disabled:C||!u.trim(),children:C?"Posting...":"Post Comment"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Comments ",c.length>0&&`(${c.length})`]}),c.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No comments yet. Be the first to share your thoughts!"}):e.jsx("div",{className:"space-y-4",children:c.map(t=>e.jsxs("div",{className:"bg-muted/50 dark:bg-blog-surface-elevated rounded-lg p-4 border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(W,{variant:"secondary",children:t.user_name}),e.jsx("span",{className:"text-sm text-muted-foreground",children:S(t.created_at)})]}),e.jsx("p",{className:"text-foreground whitespace-pre-wrap leading-relaxed",children:t.content})]},t.id))})]})]})]})]}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(v,{children:e.jsxs(_,{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground mb-4",children:"Story not found"}),e.jsx(j,{asChild:!0,children:e.jsx(R,{to:"/stories",children:"Back to Stories"})})]})})})}export{de as StoryDetail};

var W=Object.defineProperty,q=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var D=(o,i,a)=>i in o?W(o,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[i]=a,h=(o,i)=>{for(var a in i||(i={}))J.call(i,a)&&D(o,a,i[a]);if(P)for(var a of P(i))K.call(i,a)&&D(o,a,i[a]);return o},u=(o,i)=>q(o,G(i));var f=(o,i,a)=>new Promise((v,g)=>{var w=d=>{try{p(a.next(d))}catch(S){g(S)}},C=d=>{try{p(a.throw(d))}catch(S){g(S)}},p=d=>d.done?v(d.value):Promise.resolve(d.value).then(w,C);p((a=a.apply(o,i)).next())});import{j as s}from"./ui-A2uwYMgR.js";import{r as m}from"./vendor-BcaInPIV.js";import{c as O,u as Q,e as x,a as N,L as b,U as X}from"./index-poV0AmOA.js";import{C as F,a as z,b as Z,c as y}from"./card-BJEL2FVY.js";import{T as I}from"./textarea-C-jUvquv.js";import{C as ee,S as se}from"./separator-C0cBpoXy.js";import{H as te,M as ae,B as ne}from"./badge-BNYi4Huv.js";import{s as re,l as L,c as B}from"./database-C2phYdg0.js";import"./supabase-cZfeQMuK.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=O("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);function je(){const[o,i]=m.useState([]),[a,v]=m.useState({}),[g,w]=m.useState({}),[C,p]=m.useState(new Set),[d,S]=m.useState(new Set),[M,H]=m.useState(!0),[k,_]=m.useState(new Set),{user:l}=Q();m.useEffect(()=>{T()},[l]);const T=()=>f(this,null,function*(){try{const e=yield re.getStories(l==null?void 0:l.id);i(e)}catch(e){console.error("Error loading stories:",e),x.error("Failed to load stories")}finally{H(!1)}}),U=e=>f(this,null,function*(){try{const n=yield B.getComments(e);v(t=>u(h({},t),{[e]:n}))}catch(n){console.error("Error loading comments:",n),x.error("Failed to load comments")}}),Y=(e,n)=>f(this,null,function*(){if(!l){x.error("You must be logged in to like stories");return}try{n?yield L.unlikeStory(e,l.id):yield L.likeStory(e,l.id),i(t=>t.map(r=>r.id===e?u(h({},r),{user_liked:!n,likes_count:n?(r.likes_count||0)-1:(r.likes_count||0)+1}):r))}catch(t){console.error("Error toggling like:",t),x.error("Failed to update like")}}),$=e=>f(this,null,function*(){var t;if(!l){x.error("You must be logged in to comment");return}const n=(t=g[e])==null?void 0:t.trim();if(!n){x.error("Please enter a comment");return}_(r=>new Set(r).add(e));try{const r=yield B.createComment({story_id:e,content:n},l.id,l.name);v(c=>u(h({},c),{[e]:[...c[e]||[],r]})),i(c=>c.map(j=>j.id===e?u(h({},j),{comments_count:(j.comments_count||0)+1}):j)),w(c=>u(h({},c),{[e]:""})),x.success("Comment added successfully!")}catch(r){console.error("Error adding comment:",r),x.error("Failed to add comment")}finally{_(r=>{const c=new Set(r);return c.delete(e),c})}}),A=e=>f(this,null,function*(){C.has(e)?p(t=>{const r=new Set(t);return r.delete(e),r}):(p(t=>new Set(t).add(e)),a[e]||(yield U(e)))}),R=e=>{S(n=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t})},V=(e,n=200)=>e.length<=n?e:e.substring(0,n)+"...",E=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return M?s.jsx("div",{className:"container mx-auto px-4 py-8",children:s.jsx("div",{className:"text-center",children:"Loading stories..."})}):s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsxs("div",{className:"flex justify-between items-center mb-8",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold",children:"Stories"}),s.jsx("p",{className:"text-muted-foreground",children:"Discover and share amazing stories"})]}),l&&s.jsx(N,{asChild:!0,children:s.jsxs(b,{to:"/create-story",children:[s.jsx(ie,{className:"w-4 h-4 mr-2"}),"Create Story"]})})]}),o.length===0?s.jsx(F,{children:s.jsxs(z,{className:"text-center py-8",children:[s.jsx("p",{className:"text-muted-foreground mb-4",children:"Ajayadev is cooking one. no stories yet!"}),l&&s.jsx(N,{asChild:!0,children:s.jsx(b,{to:"/create-story",children:"Create Your First Story"})})]})}):s.jsx("div",{className:"space-y-6",children:o.map(e=>{var n,t,r;return s.jsxs(F,{children:[s.jsx(Z,{children:s.jsx("div",{className:"flex justify-between items-start",children:s.jsxs("div",{className:"space-y-2 flex-1",children:[s.jsx(b,{to:`/story/${e.id}`,children:s.jsx(y,{className:"text-xl hover:text-blog-primary transition-colors cursor-pointer",children:e.title})}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(X,{className:"w-4 h-4"}),e.author_name]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(ee,{className:"w-4 h-4"}),E(e.created_at)]})]})]})})}),s.jsxs(z,{children:[s.jsxs("div",{className:"mb-4",children:[s.jsx("p",{className:"text-foreground whitespace-pre-wrap",children:d.has(e.id)?e.content:V(e.content)}),e.content.length>200&&s.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[s.jsx(N,{variant:"link",size:"sm",onClick:()=>R(e.id),className:"p-0 h-auto text-blog-primary hover:text-blog-accent",children:d.has(e.id)?"Show less":"Read more"}),!d.has(e.id)&&s.jsx("span",{className:"text-muted-foreground",children:"•"}),!d.has(e.id)&&s.jsx(b,{to:`/story/${e.id}`,className:"text-blog-primary hover:text-blog-accent text-sm",children:"View full story →"})]})]}),s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>Y(e.id,e.user_liked||!1),className:"flex items-center gap-1",disabled:!l,children:[s.jsx(te,{className:`w-4 h-4 ${e.user_liked?"fill-red-500 text-red-500":""}`}),e.likes_count||0]}),s.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>A(e.id),className:"flex items-center gap-1",children:[s.jsx(ae,{className:"w-4 h-4"}),e.comments_count||0]})]})}),C.has(e.id)&&s.jsxs(s.Fragment,{children:[s.jsx(se,{className:"my-4"}),l&&s.jsxs("div",{className:"space-y-2 mb-4",children:[s.jsx(I,{placeholder:"Write a comment...",value:g[e.id]||"",onChange:c=>w(j=>u(h({},j),{[e.id]:c.target.value})),rows:2}),s.jsx(N,{size:"sm",onClick:()=>$(e.id),disabled:k.has(e.id)||!((n=g[e.id])!=null&&n.trim()),children:k.has(e.id)?"Posting...":"Post Comment"})]}),s.jsxs("div",{className:"space-y-3",children:[(t=a[e.id])==null?void 0:t.map(c=>s.jsxs("div",{className:"bg-muted/50 dark:bg-blog-surface-elevated rounded-lg p-3 border border-border",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx(ne,{variant:"secondary",className:"text-xs",children:c.user_name}),s.jsx("span",{className:"text-xs text-muted-foreground",children:E(c.created_at)})]}),s.jsx("p",{className:"text-sm text-foreground whitespace-pre-wrap",children:c.content})]},c.id)),((r=a[e.id])==null?void 0:r.length)===0&&s.jsx("p",{className:"text-center text-muted-foreground text-sm py-4",children:"No comments yet. Be the first to comment!"})]})]})]})]},e.id)})})]})}export{je as StoriesPage};
